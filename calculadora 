import 'package:flutter/material.dart';

void main() => runApp(MaterialApp(home: IMCApp(), debugShowCheckedModeBanner: false));

class IMCApp extends StatefulWidget {
  @override
  _IMCAppState createState() => _IMCAppState();
}

class _IMCAppState extends State<IMCApp> {
  final peso = TextEditingController(), altura = TextEditingController(), form = GlobalKey<FormState>();
  String res = 'Informe seus dados';

  void calc() {
    try {
      final p = double.parse(peso.text), a = double.parse(altura.text) / 100, imc = p / (a * a);
      res = "IMC = ${imc.toStringAsPrecision(2)}\n" +
          (imc < 18.6 ? "Abaixo do peso" : imc < 25 ? "Peso ideal" : imc < 30 ? "Levemente acima" : imc < 35 ? "Obesidade I" : imc < 40 ? "Obesidade II" : "Obesidade III");
    } catch (e) {
      res = "Erro: insira valores vÃ¡lidos";
    }
    setState(() {});
  }

  @override
  Widget build(BuildContext c) => Scaffold(
        appBar: AppBar(title: Text('IMC'), actions: [IconButton(icon: Icon(Icons.refresh), onPressed: () => setState(() => {peso.clear(), altura.clear(), res = 'Informe seus dados'}))]),
        body: Padding(
          padding: EdgeInsets.all(20),
          child: Form(
            key: form,
            child: Column(children: [
              for (var f in [
                {'l': 'Peso (kg)', 'c': peso, 'e': 'Insira o peso!'},
                {'l': 'Altura (cm)', 'c': altura, 'e': 'Insira a altura!'}
              ])
                TextFormField(
                  controller: f['c'] as TextEditingController,
                  decoration: InputDecoration(labelText: f['l'] as String),
                  keyboardType: TextInputType.number,
                  validator: (t) => (t == null || t.isEmpty) ? f['e'] as String : null,
                ),
              Padding(padding: EdgeInsets.symmetric(vertical: 30), child: Text(res, textAlign: TextAlign.center)),
              ElevatedButton(
                  onPressed: () {
                    if (form.currentState!.validate()) calc();
                  },
                  child: Text('CALCULAR'))
            ]),
          ),
        ),
      );
}